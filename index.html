<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Text Editor</title>
    <style>
        #imageContainer {
            position: relative;
        }

        .draggable-textbox {
            position: absolute;
            cursor: move;
            border: 1px solid #ccc;
            background-color: white;
            padding: 5px;
        }
    </style>
</head>
<body>
    <h1>Image Text Editor</h1>

    <div>
        <label for="imageUpload">Upload Image:</label>
        <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(event)">
    </div>

    <div id="imageContainer">
        <img id="uploadedImage" style="max-width: 100%;" alt="Uploaded Image">
    </div>

    <div id="textEditor">
        <label for="textInput">Enter Text:</label>
        <input type="text" id="textInput">
        <button onclick="addTextbox()">Add Textbox</button>
        <button onclick="downloadImage()">Download Image</button>
    </div>

    <script>
        let imageContainer = document.getElementById('imageContainer');
        let textEditor = document.getElementById('textEditor');
        let uploadedImage = document.getElementById('uploadedImage');

        function handleImageUpload(event) {
            let file = event.target.files[0];
            if (file) {
                let reader = new FileReader();
                reader.onload = function (e) {
                    uploadedImage.src = e.target.result;
                    uploadedImage.onload = function () {
                        textEditor.style.display = 'block';
                    };
                };
                reader.readAsDataURL(file);
            }
        }

        function addTextbox() {
            let textbox = document.createElement('div');
            textbox.classList.add('draggable-textbox');
            textbox.contentEditable = true;
            textbox.addEventListener('mousedown', startDragging);
            imageContainer.appendChild(textbox);
        }

        function startDragging(e) {
            let offsetX = e.clientX - e.target.getBoundingClientRect().left;
            let offsetY = e.clientY - e.target.getBoundingClientRect().top;

            function dragMove(moveEvent) {
                let x = moveEvent.clientX - offsetX;
                let y = moveEvent.clientY - offsetY;

                e.target.style.left = x + 'px';
                e.target.style.top = y + 'px';
            }

            function dragEnd() {
                document.removeEventListener('mousemove', dragMove);
                document.removeEventListener('mouseup', dragEnd);
            }

            document.addEventListener('mousemove', dragMove);
            document.addEventListener('mouseup', dragEnd);
        }

        function downloadImage() {
            // Create a clone of the image container with textboxes
            let cloneContainer = imageContainer.cloneNode(true);
            let textboxes = cloneContainer.getElementsByClassName('draggable-textbox');

            // Position textboxes relative to the image
            for (let i = 0; i < textboxes.length; i++) {
                let textbox = textboxes[i];
                let rect = textbox.getBoundingClientRect();
                let imageRect = uploadedImage.getBoundingClientRect();

                let x = rect.left - imageRect.left;
                let y = rect.top - imageRect.top;

                textbox.style.left = x + 'px';
                textbox.style.top = y + 'px';

                // Remove dragging functionality for the cloned textboxes
                textbox.removeEventListener('mousedown', startDragging);
            }

            // Convert the HTML content to an image
            html2canvas(cloneContainer).then(function(canvas) {
                // Convert the canvas to a data URL
                let imageURL = canvas.toDataURL('image/png');

                // Create a link element and trigger a download
                let link = document.createElement('a');
                link.href = imageURL;
                link.download = 'edited_image.png';
                link.click();
            });
        }
    </script>

    <!-- Include the html2canvas library -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</body>
</html>
